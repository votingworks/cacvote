APP := cacvote-jx-terminal

ALL: build

clean: clean-backend

clean-backend:
	@echo "ğŸ§¹ Cleaning backendâ€¦"
	@cd backend && cargo clean

build: build-frontend build-backend

build-frontend:
	@echo "ğŸ› ï¸ Building frontendâ€¦"
	@cd frontend && pnpm build

build-backend:
	@echo "ğŸ› ï¸ Building backendâ€¦"
	@cd backend && cargo build --release

dist: build
	@echo "ğŸ“¦ Packaging applicationâ€¦"
	@rm -rf dist && mkdir dist
	@cp -r frontend/build dist/public
	@cp ../../target/release/$(APP)-backend dist/$(APP)
	@echo "- \e[34;4mdist/public\e[0m: frontend assets"
	@echo "- \e[34;4mdist/$(APP)\e[0m: application binary"

run: dist
	@echo "ğŸš€ Running application in production modeâ€¦"
	@cd dist && ./$(APP)

reset-db:
	@echo "ğŸ—‘ï¸ Resetting databaseâ€¦"
	@cd backend && cargo sqlx database reset --source db/migrations
	@echo "âœ… Database reset"