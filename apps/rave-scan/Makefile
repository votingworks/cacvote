APP := rave-scan

ALL: build

clean: clean-frontend clean-backend

clean-frontend:
	@echo "ğŸ§¹ Cleaning frontendâ€¦"
	@cd frontend && dx clean

clean-backend:
	@echo "ğŸ§¹ Cleaning backendâ€¦"
	@cd backend && cargo clean

build: build-frontend build-backend

build-frontend:
	@echo "ğŸ› ï¸ Building frontendâ€¦"
	@cd frontend && dx build --release

build-backend:
	@echo "ğŸ› ï¸ Building backendâ€¦"
	@cd backend && cargo build --release

dist: build
	@echo "ğŸ“¦ Packaging applicationâ€¦"
	@rm -rf dist && mkdir dist
	@cp -r frontend/dist dist/public
	@cp ../../target/release/$(APP)-backend dist/$(APP)
	@echo "- \e[34;4mdist/public\e[0m: frontend assets"
	@echo "- \e[34;4mdist/$(APP)\e[0m: application binary"

run: dist
	@echo "ğŸš€ Running application in production modeâ€¦"
	@cd dist && ./$(APP)

reset-db:
	@echo "ğŸ—‘ï¸ Resetting databaseâ€¦"
	@cd backend && cargo sqlx database reset --source db/migrations
	@echo "âœ… Database reset"