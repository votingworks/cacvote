APP := rave-mark

ALL: build

clean: clean-frontend clean-backend

clean-frontend:
	@echo "ğŸ§¹ Cleaning frontendâ€¦"
	@cd frontend && pnpm clean

clean-backend:
	@echo "ğŸ§¹ Cleaning backendâ€¦"
	@cd backend && pnpm clean

build: build-frontend build-backend

build-frontend:
	@echo "ğŸ› ï¸ Building frontendâ€¦"
	@cd frontend && pnpm build

build-backend:
	@echo "ğŸ› ï¸ Building backendâ€¦"
	@cd backend && pnpm build

dist:
	@echo "âŒ Not implemented yet"
	@exit 1

run: build
	@echo "ğŸš€ Running application in production modeâ€¦"
	@cd frontend && NODE_ENV=production pnpm concurrently --kill-others --names frontend,backend "pnpm --dir prodserver start" "pnpm --dir ../backend start"

reset-db:
	@echo "ğŸ—‘ï¸ Resetting databaseâ€¦"
	@test -d "${RAVE_MARK_WORKSPACE}" && rm -rf "${RAVE_MARK_WORKSPACE}" && echo "âœ… Database reset" || echo "âŒ Database not reset, no RAVE_MARK_WORKSPACE"